<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>scicat-backend-next documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">scicat-backend-next documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >UsersService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/users/users.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#create" >create</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createCustomJWT" >createCustomJWT</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createUserIdentity" >createUserIdentity</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createUserJWT" >createUserJWT</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createUserSettings" >createUserSettings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findById" >findById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findById2JWTUser" >findById2JWTUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findByIdUserIdentity" >findByIdUserIdentity</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findByIdUserSettings" >findByIdUserSettings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOne" >findOne</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneAndRemoveUserSettings" >findOneAndRemoveUserSettings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneAndUpdateUserSettings" >findOneAndUpdateUserSettings</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOrCreate" >findOrCreate</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#onModuleInit" >onModuleInit</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#removeUserIdentity" >removeUserIdentity</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateUserIdentity" >updateUserIdentity</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#userExists" >userExists</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(configService: ConfigService, jwtService: JwtService, rolesService: <a href="../injectables/RolesService.html" target="_self">RolesService</a>, userModel: <a href="../classes/User.html" target="_self">Model&lt;UserDocument&gt;</a>, userIdentityModel: <a href="../undefineds/UserIdentityDocument.html" target="_self">Model&lt;UserIdentityDocument&gt;</a>, userSettingsModel: <a href="../undefineds/UserSettingsDocument.html" target="_self">Model&lt;UserSettingsDocument&gt;</a>, accessGroupService: <a href="../classes/AccessGroupService.html" target="_self">AccessGroupService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/users/users.service.ts:31</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>configService</td>
                                                  
                                                        <td>
                                                                    <code>ConfigService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>jwtService</td>
                                                  
                                                        <td>
                                                                    <code>JwtService</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>rolesService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/RolesService.html" target="_self" >RolesService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/User.html" target="_self" >Model&lt;UserDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userIdentityModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/typealiases.html#UserIdentityDocument" target="_self" >Model&lt;UserIdentityDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userSettingsModel</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/typealiases.html#UserSettingsDocument" target="_self" >Model&lt;UserSettingsDocument&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>accessGroupService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/AccessGroupService.html" target="_self" >AccessGroupService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="create"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>create</b></span>
                        <a href="#create"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>create(createUserDto: <a href="../classes/CreateUserDto.html" target="_self">CreateUserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="151"
                            class="link-to-prism">src/users/users.service.ts:151</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>createUserDto</td>
                                    <td>
                                                <code><a href="../classes/CreateUserDto.html" target="_self" >CreateUserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/User.html" target="_self" >Promise&lt;User | null&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createCustomJWT"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>createCustomJWT</b></span>
                        <a href="#createCustomJWT"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createCustomJWT(user: <a href="../classes/User.html" target="_self">Omit&lt;User | password&gt;</a>, jwtProperties: JwtSignOptions)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="305"
                            class="link-to-prism">src/users/users.service.ts:305</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >Omit&lt;User | password&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>jwtProperties</td>
                                    <td>
                                            <code>JwtSignOptions</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;CreateUserJWT | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createUserIdentity"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>createUserIdentity</b></span>
                        <a href="#createUserIdentity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createUserIdentity(createUserIdentityDto: <a href="../classes/CreateUserIdentityDto.html" target="_self">CreateUserIdentityDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="220"
                            class="link-to-prism">src/users/users.service.ts:220</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>createUserIdentityDto</td>
                                    <td>
                                                <code><a href="../classes/CreateUserIdentityDto.html" target="_self" >CreateUserIdentityDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserIdentity&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createUserJWT"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>createUserJWT</b></span>
                        <a href="#createUserJWT"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createUserJWT(accessToken: <a href="../interfaces/JWTUser.html" target="_self">JWTUser | undefined</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="279"
                            class="link-to-prism">src/users/users.service.ts:279</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>accessToken</td>
                                    <td>
                                                <code><a href="../interfaces/JWTUser.html" target="_self" >JWTUser | undefined</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;CreateUserJWT | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createUserSettings"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>createUserSettings</b></span>
                        <a href="#createUserSettings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createUserSettings(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, createUserSettingsDto: <a href="../classes/CreateUserSettingsDto.html" target="_self">CreateUserSettingsDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="251"
                            class="link-to-prism">src/users/users.service.ts:251</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>createUserSettingsDto</td>
                                    <td>
                                                <code><a href="../classes/CreateUserSettingsDto.html" target="_self" >CreateUserSettingsDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserSettings&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findById</b></span>
                        <a href="#findById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="200"
                            class="link-to-prism">src/users/users.service.ts:200</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Omit | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findById2JWTUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findById2JWTUser</b></span>
                        <a href="#findById2JWTUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findById2JWTUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="204"
                            class="link-to-prism">src/users/users.service.ts:204</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/JWTUser.html" target="_self" >Promise&lt;JWTUser | null&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findByIdUserIdentity"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findByIdUserIdentity</b></span>
                        <a href="#findByIdUserIdentity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findByIdUserIdentity(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="247"
                            class="link-to-prism">src/users/users.service.ts:247</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserIdentity | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findByIdUserSettings"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findByIdUserSettings</b></span>
                        <a href="#findByIdUserSettings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findByIdUserSettings(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="262"
                            class="link-to-prism">src/users/users.service.ts:262</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserSettings | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOne"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOne</b></span>
                        <a href="#findOne"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOne(filter: <a href="../classes/User.html" target="_self">FilterQuery&lt;UserDocument&gt;</a>, includePassword)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="191"
                            class="link-to-prism">src/users/users.service.ts:191</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >FilterQuery&lt;UserDocument&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>includePassword</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Omit | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneAndRemoveUserSettings"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOneAndRemoveUserSettings</b></span>
                        <a href="#findOneAndRemoveUserSettings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneAndRemoveUserSettings(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="275"
                            class="link-to-prism">src/users/users.service.ts:275</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneAndUpdateUserSettings"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOneAndUpdateUserSettings</b></span>
                        <a href="#findOneAndUpdateUserSettings"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneAndUpdateUserSettings(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, updateUserSettingsDto: <a href="../classes/UpdateUserSettingsDto.html" target="_self">UpdateUserSettingsDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="266"
                            class="link-to-prism">src/users/users.service.ts:266</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>updateUserSettingsDto</td>
                                    <td>
                                                <code><a href="../classes/UpdateUserSettingsDto.html" target="_self" >UpdateUserSettingsDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserSettings | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOrCreate"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOrCreate</b></span>
                        <a href="#findOrCreate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOrCreate(createUserDto: <a href="../classes/CreateUserDto.html" target="_self">CreateUserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="173"
                            class="link-to-prism">src/users/users.service.ts:173</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>createUserDto</td>
                                    <td>
                                                <code><a href="../classes/CreateUserDto.html" target="_self" >CreateUserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Omit | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onModuleInit"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>onModuleInit</b></span>
                        <a href="#onModuleInit"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>onModuleInit()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="44"
                            class="link-to-prism">src/users/users.service.ts:44</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="removeUserIdentity"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>removeUserIdentity</b></span>
                        <a href="#removeUserIdentity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>removeUserIdentity(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="239"
                            class="link-to-prism">src/users/users.service.ts:239</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserIdentity | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserIdentity"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateUserIdentity</b></span>
                        <a href="#updateUserIdentity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateUserIdentity(updateUserIdentityDto: <a href="../classes/UpdateUserIdentityDto.html" target="_self">UpdateUserIdentityDto</a>, userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="229"
                            class="link-to-prism">src/users/users.service.ts:229</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>updateUserIdentityDto</td>
                                    <td>
                                                <code><a href="../classes/UpdateUserIdentityDto.html" target="_self" >UpdateUserIdentityDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UserIdentity | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="userExists"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>userExists</b></span>
                        <a href="#userExists"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>userExists(filter: <a href="../classes/User.html" target="_self">FilterQuery&lt;UserDocument&gt;</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="146"
                            class="link-to-prism">src/users/users.service.ts:146</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>filter</td>
                                    <td>
                                                <code><a href="../classes/User.html" target="_self" >FilterQuery&lt;UserDocument&gt;</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, Logger, OnModuleInit } from &quot;@nestjs/common&quot;;
import { ConfigService } from &quot;@nestjs/config&quot;;
import { InjectModel } from &quot;@nestjs/mongoose&quot;;
import { genSalt, hash } from &quot;bcrypt&quot;;
import { FilterQuery, Model, ObjectId } from &quot;mongoose&quot;;
import { CreateUserIdentityDto } from &quot;./dto/create-user-identity.dto&quot;;
import { CreateUserDto } from &quot;./dto/create-user.dto&quot;;
import { RolesService } from &quot;./roles.service&quot;;
import {
  UserIdentity,
  UserIdentityDocument,
} from &quot;./schemas/user-identity.schema&quot;;
import { User, UserDocument } from &quot;./schemas/user.schema&quot;;
import { CreateRoleDto } from &quot;./dto/create-role.dto&quot;;
import { CreateUserRoleDto } from &quot;./dto/create-user-role.dto&quot;;
import { CreateUserJWT } from &quot;./dto/create-user-jwt.dto&quot;;
import { JwtService, JwtSignOptions } from &quot;@nestjs/jwt&quot;;
import { JWTUser } from &quot;../auth/interfaces/jwt-user.interface&quot;;
import * as fs from &quot;fs&quot;;
import {
  UserSettings,
  UserSettingsDocument,
} from &quot;./schemas/user-settings.schema&quot;;
import { CreateUserSettingsDto } from &quot;./dto/create-user-settings.dto&quot;;
import { UpdateUserSettingsDto } from &quot;./dto/update-user-settings.dto&quot;;
import { UpdateUserIdentityDto } from &quot;./dto/update-user-identity.dto&quot;;
import { UserPayload } from &quot;src/auth/interfaces/userPayload.interface&quot;;
import { AccessGroupService } from &quot;src/auth/access-group-provider/access-group.service&quot;;

@Injectable()
export class UsersService implements OnModuleInit {
  constructor(
    private configService: ConfigService,
    private jwtService: JwtService,
    private rolesService: RolesService,
    @InjectModel(User.name) private userModel: Model&lt;UserDocument&gt;,
    @InjectModel(UserIdentity.name)
    private userIdentityModel: Model&lt;UserIdentityDocument&gt;,
    @InjectModel(UserSettings.name)
    private userSettingsModel: Model&lt;UserSettingsDocument&gt;,
    private accessGroupService: AccessGroupService,
  ) {}

  async onModuleInit() {
    let functionalAccounts &#x3D;
      this.configService.get&lt;CreateUserDto[]&gt;(&quot;functionalAccounts&quot;);

    const filePath &#x3D; &quot;functionalAccounts.json&quot;;
    if (fs.existsSync(filePath)) {
      const data &#x3D; fs.readFileSync(filePath, &quot;utf8&quot;);
      functionalAccounts &#x3D; JSON.parse(data);
    }

    if (functionalAccounts &amp;&amp; functionalAccounts.length &gt; 0) {
      const accountPromises &#x3D; functionalAccounts.map(async (account) &#x3D;&gt; {
        const { role, global, ...createAccount } &#x3D; account;
        createAccount.authStrategy &#x3D; &quot;local&quot;;
        const user &#x3D; await this.findOrCreate(createAccount);
        const roles: Record&lt;string, Array&lt;string&gt;&gt; &#x3D; {};

        if (user) {
          const userPayload: UserPayload &#x3D; {
            userId: user.id as string,
            username: user.username,
            email: user.email,
          };
          const accessGroupsOrig &#x3D;
            await this.accessGroupService.getAccessGroups(userPayload);
          const accessGroups &#x3D; [...accessGroupsOrig];

          if (role) {
            // add role as access group
            accessGroups.push(role);
            if (!(role in roles)) {
              roles[role] &#x3D; [];
            }
            roles[role].push(user._id.toString());
          }
          if (global) {
            accessGroups.push(&quot;globalaccess&quot;);
            if (!(&quot;globalaccess&quot; in roles)) {
              roles[&quot;globalaccess&quot;] &#x3D; [];
            }
            roles[&quot;globalaccess&quot;].push(user._id.toString());
          }

          // creates user identity to store access groups
          const createUserIdentity: CreateUserIdentityDto &#x3D; {
            authStrategy: &quot;local&quot;,
            credentials: {},
            externalId: &quot;&quot;,
            profile: {
              displayName: account.username as string,
              email: account.email as string,
              username: account.username as string,
              thumbnailPhoto: &quot;error: no photo found&quot;,
              emails: [{ value: account.email as string }],
              accessGroups: [...new Set([role as string, ...accessGroups])],
              id: user.id as string,
            },
            provider: &quot;local&quot;,
            userId: user._id,
          };

          const tempUserIdentity &#x3D; await this.findByIdUserIdentity(user._id);
          if (tempUserIdentity) {
            await this.updateUserIdentity(createUserIdentity, user._id);
          } else {
            await this.createUserIdentity(createUserIdentity);
          }
        }
        return roles;
      });

      const results &#x3D; await Promise.all(accountPromises);
      const roles &#x3D; results.reduce((a, b) &#x3D;&gt; {
        Object.keys(b).forEach((k) &#x3D;&gt; {
          if (k in a) {
            a[k] &#x3D; a[k].concat(b[k]);
          } else {
            a[k] &#x3D; b[k];
          }
        });
        return a;
      }, {});
      if (roles) {
        for (const [role, userIds] of Object.entries(roles)) {
          const createRole: CreateRoleDto &#x3D; {
            name: role,
          };
          const createdRole &#x3D; await this.rolesService.findOrCreate(createRole);
          if (createdRole &amp;&amp; userIds) {
            userIds.forEach(async (userId) &#x3D;&gt; {
              const createUserRole: CreateUserRoleDto &#x3D; {
                userId: userId,
                roleId: createdRole._id,
              };
              await this.rolesService.findOrCreateUserRole(createUserRole);
            });
          }
        }
      }
    }
  }

  async userExists(filter: FilterQuery&lt;UserDocument&gt;): Promise&lt;boolean&gt; {
    const user &#x3D; await this.userModel.exists(filter);
    return user ? true : false;
  }

  async create(createUserDto: CreateUserDto): Promise&lt;User | null&gt; {
    Logger.log(
      &#x60;Creating user ${createUserDto.username} ( Strategy : ${createUserDto.authStrategy} )&#x60;,
      &quot;UsersService&quot;,
    );

    if (createUserDto.authStrategy !&#x3D;&#x3D; &quot;local&quot;) {
      const { password, ...sanitizedCreateUserDto } &#x3D; createUserDto;
      const createdUser &#x3D; new this.userModel(sanitizedCreateUserDto);
      return createdUser.save();
    } else if (createUserDto.password) {
      const hashedPassword &#x3D; await hash(
        createUserDto.password,
        await genSalt(),
      );
      const createUser &#x3D; { ...createUserDto, password: hashedPassword };
      const createdUser &#x3D; new this.userModel(createUser);
      return createdUser.save();
    }
    return null;
  }

  async findOrCreate(
    createUserDto: CreateUserDto,
  ): Promise&lt;Omit&lt;User, &quot;password&quot;&gt; | null&gt; {
    const userFilter: FilterQuery&lt;UserDocument&gt; &#x3D; {
      $or: [
        { username: createUserDto.username },
        { email: createUserDto.email },
      ],
    };
    const userExists &#x3D; await this.userExists(userFilter);

    if (userExists) {
      return await this.findOne(userFilter);
    }

    return await this.create(createUserDto);
  }

  async findOne(
    filter: FilterQuery&lt;UserDocument&gt;,
    includePassword &#x3D; false,
  ): Promise&lt;Omit&lt;User, &quot;password&quot;&gt; | null&gt; {
    return includePassword
      ? this.userModel.findOne(filter).select(&quot;+password&quot;).exec()
      : this.userModel.findOne(filter).exec();
  }

  async findById(id: string): Promise&lt;Omit&lt;User, &quot;password&quot;&gt; | null&gt; {
    return this.userModel.findById(id).exec();
  }

  async findById2JWTUser(id: string): Promise&lt;JWTUser | null&gt; {
    const userIdentity &#x3D; await this.userIdentityModel
      .findOne({ userId: id })
      .exec();
    if (userIdentity) {
      const userProfile &#x3D; userIdentity.profile;
      return {
        _id: userProfile.id,
        username: userProfile.username,
        email: userProfile.email,
        currentGroups: userProfile.accessGroups,
      } as JWTUser;
    }
    return null;
  }

  async createUserIdentity(
    createUserIdentityDto: CreateUserIdentityDto,
  ): Promise&lt;UserIdentity&gt; {
    const createdUserIdentity &#x3D; new this.userIdentityModel(
      createUserIdentityDto,
    );
    return createdUserIdentity.save();
  }

  async updateUserIdentity(
    updateUserIdentityDto: UpdateUserIdentityDto,
    userId: string,
  ): Promise&lt;UserIdentity | null&gt; {
    return this.userIdentityModel
      .findOneAndUpdate({ userId }, updateUserIdentityDto, { new: true })
      .exec();
  }

  // NOTE: This is just for testing purposes inside accessGroups.e2e-spec.ts
  async removeUserIdentity(userId: string): Promise&lt;UserIdentity | null&gt; {
    const removedUserIdentity &#x3D; await this.userIdentityModel
      .findOneAndDelete({ userId })
      .exec();

    return removedUserIdentity;
  }

  async findByIdUserIdentity(userId: string): Promise&lt;UserIdentity | null&gt; {
    return this.userIdentityModel.findOne({ userId }).exec();
  }

  async createUserSettings(
    userId: string,
    createUserSettingsDto: CreateUserSettingsDto,
  ): Promise&lt;UserSettings&gt; {
    const createdUserSettings &#x3D; new this.userSettingsModel({
      ...createUserSettingsDto,
      userId,
    });
    return createdUserSettings.save();
  }

  async findByIdUserSettings(userId: string): Promise&lt;UserSettings | null&gt; {
    return this.userSettingsModel.findOne({ userId }).exec();
  }

  async findOneAndUpdateUserSettings(
    userId: string,
    updateUserSettingsDto: UpdateUserSettingsDto,
  ): Promise&lt;UserSettings | null&gt; {
    return this.userSettingsModel
      .findOneAndUpdate({ userId }, updateUserSettingsDto, { new: true })
      .exec();
  }

  async findOneAndRemoveUserSettings(userId: string): Promise&lt;unknown&gt; {
    return this.userSettingsModel.findOneAndRemove({ userId }).exec();
  }

  async createUserJWT(
    accessToken: JWTUser | undefined,
  ): Promise&lt;CreateUserJWT | null&gt; {
    const signAndVerifyOptions &#x3D; {
      expiresIn: this.configService.get&lt;string&gt;(&quot;jwt.expiresIn&quot;) || &quot;1h&quot;,
      secret: this.configService.get&lt;string&gt;(&quot;jwt.secret&quot;),
    };

    if (!accessToken) {
      const groups &#x3D; [&quot;public&quot;];
      const payload &#x3D; {
        username: &quot;anonymous&quot;,
        groups,
      };
      const jwtString &#x3D; this.jwtService.sign(payload, signAndVerifyOptions);
      return { jwt: jwtString };
    }

    const payload &#x3D; {
      username: accessToken._id,
      groups: accessToken.currentGroups,
    };
    const jwtString &#x3D; this.jwtService.sign(payload, signAndVerifyOptions);
    return { jwt: jwtString };
  }

  async createCustomJWT(
    user: Omit&lt;User, &quot;password&quot;&gt;,
    jwtProperties: JwtSignOptions,
  ): Promise&lt;CreateUserJWT | null&gt; {
    const signAndVerifyOptions: JwtSignOptions &#x3D; {
      ...jwtProperties,
    } as JwtSignOptions;
    if (signAndVerifyOptions.expiresIn &#x3D;&#x3D; &quot;never&quot;) {
      signAndVerifyOptions.expiresIn &#x3D;
        this.configService.get&lt;string&gt;(&quot;jwt.neverExpires&quot;) || &quot;100y&quot;;
    } else if (
      typeof signAndVerifyOptions.expiresIn &#x3D;&#x3D;&#x3D; &quot;string&quot; &amp;&amp;
      signAndVerifyOptions.expiresIn &amp;&amp;
      !isNaN(+signAndVerifyOptions.expiresIn)
    ) {
      signAndVerifyOptions.expiresIn &#x3D; parseInt(signAndVerifyOptions.expiresIn);
    } else if (!signAndVerifyOptions.expiresIn) {
      signAndVerifyOptions.expiresIn &#x3D;
        this.configService.get&lt;string&gt;(&quot;jwt.expiresIn&quot;) || &quot;1h&quot;;
    }
    signAndVerifyOptions.secret &#x3D; this.configService.get&lt;string&gt;(&quot;jwt.secret&quot;);
    const jwtString &#x3D; this.jwtService.sign(user, signAndVerifyOptions);
    return { jwt: jwtString };
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UsersService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
